<%- console.log(title)%>
<div class="row-fluid">
    <!-- Modal for departmet add starts -->
    <div  class="modal hide fade" tabindex="-1" data-keyboard="false" data-backdrop="static" role="dialog" aria-labelledby="modal<%=fnPrefix%>Label" aria-hidden="false" id="modal<%=fnPrefix%>">
         <form id="frmAdd<%=fnPrefix%>" class="validate" action="#" style="margin-bottom:0px">
               <div class="error validate">
               </div>
             <input type="hidden" id="hiddentxt<%=fnPrefix%>"value="0"/>
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h3 id="modal<%=fnPrefix%>Label">Add <%=fnPrefix%></h3>
              </div>
              <div class="modal-body">
                  <div id="modal<%=fnPrefix%>Body" class="modal<%=fnPrefix%>Body validate">
                      <div class="row-fluid">
                          <div class="span12">
                           <label class="control-label label-bold" for="txt<%=fnPrefix%>Name">Name</label>
                            <input type="text" class="required" id="txt<%=fnPrefix%>Name" name="txt<%=fnPrefix%>Name" placeholder="Name">
                         </div>
                        </div>
                      <div class="row-fluid">
                    <label class="label-bold">Status</label>
                </div>
                       <div class="row-fluid">
                          <div class="span3">
                              <div id="divIs<%=fnPrefix%>Status"class="but-switch vm-dummy-swith-button">
                                <input id="chkStatus<%=fnPrefix%>" type="checkbox" class="vm-dummy-swith-button">
                              </div>
                           </div>
                      </div>
                  </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary" id="btnSave<%=fnPrefix%>">Save</button>
              </div>
           </form>
    </div>
    <!-- Modal for dept ends-->
</div>
<!--Confirmation Pop up dialogs (Start)-->
<div class="modal fade" role="dialog" id="confirm-dialog-<%=fnPrefix%>">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="frm_<%=fnPrefix%>-dialog" action="#" style="margin-bottom:0px">
            <div class="modal-body">
                Are you sure you want to delete the record?
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-danger" id="btnConfirmOk">Ok</a> <a href="#"
                    class="btn btn-cancel btn-default" data-dismiss="modal">Cancel</a>
            </div>
            </form>
        </div>
    </div>
</div>
<!--Confirmation Pop up dialogs (end)-->
<script type="text/javascript">
   console.log("MasterForm");   
    <%=fnPrefix%>MasterForm = function() { 
        $.Topic("master-list-row-click_edit").subscribe(UpdateMasterData);
        $.Topic("master-list-row-click_delete").subscribe(DeleteMasterData);
        $.Topic("master-list-add-click").subscribe(function () {
            //clear the previous values
            ResetControls("modal<%=fnPrefix%>"); 
            //Reset Form
            ResetForm("frmAdd<%=fnPrefix%>");
            $("#btnSave<%=fnPrefix%>").removeAttr("disabled"); 
            $('#modal<%=fnPrefix%>Label').text("Add "+"<%=fnPrefix%>")   
            $('#modal<%=fnPrefix%>').modal('show');
        });
        FormValidation();
        $.Topic(vm_ui_events.FormSubmitClick + "_frmAdd<%=fnPrefix%>").subscribe(frmAddEdit<%=fnPrefix%>_Handler);

     function frmAddEdit<%=fnPrefix%>_Handler() {
        $.Topic(vm_ui_events.ModalAction).publish({ "body": "modal<%=fnPrefix%>Body", "footer": "modal-footer", "state": "Initiated" });
        var request = {};
        request.name = $('#txt<%=fnPrefix%>Name').val();
          if($("#chkStatus<%=fnPrefix%>").is(":checked")== false){
              request.status = 0; } 
              else{ 
              request.status = 1;}; //Status//$('#divIsdeptStatus').swatch('setState', true);
                var id=$('#hiddentxt<%=fnPrefix%>').val();
                if($('#hiddentxt<%=fnPrefix%>').val() != 0)
                {
                request.id=id;
                var promiseAddEdit<%=fnPrefix%> = $.ajax({ url: location.origin + '<%=apiupdate%>',data: request });
                }
                else
                {
                var promiseAddEdit<%=fnPrefix%> = $.ajax({ url: location.origin + '<%=apicreate%>', data: request });
                }
        promiseAddEdit<%=fnPrefix%>.done(function () {
             setTimeout(function () {
                $.Topic("ModalAction").publish({ "body": "modal<%=fnPrefix%>Body", "footer": "modal-footer", "state": "CompletedSuccess" });
                $('#modal<%=fnPrefix%>').modal('hide');
                noty({ "text": "<%=fnPrefix%> saved successfully", "layout": "top", "type": "success" });
            }, 1000);

             setTimeout(<%=fnPrefix%>ListMasterList, 0);
             //On Edit, if search is done reBind filtered list, otherwise the usual list of data
             //$("#txt<%=fnPrefix%>SearchName").val() == "" ? setTimeout(<%=fnPrefix%>Master_List_BindData, 0) 
                                                   // : setTimeout(<%=fnPrefix%>_BindOn_SearchResult, 0);      
            return false;
        })
        promiseAddEdit<%=fnPrefix%>.fail(function(){
            $('#modal<%=fnPrefix%>').modal('hide');
            noty({ "text": "Failed", "layout": "top", "type": "error" });
            console.log("from master api fail")
        });    
    }
    }
    addLoadEvent(<%=fnPrefix%>MasterForm);

    function UpdateMasterData(args)
    {
           var promiseMasterUpdate = $.ajax({ url: location.origin + '<%=apifind%>/' + args.id });
            promiseMasterUpdate.done(function(data){ 
             $("#btnSave<%=fnPrefix%>").removeAttr("disabled"); 
             $('#modal<%=fnPrefix%>Label').text("Edit "+"<%=fnPrefix%>")          
             $('#modal<%=fnPrefix%>').modal('show');
             $('#txt<%=fnPrefix%>Name').val(data.name);
             $('#divIs<%=fnPrefix%>Status').swatch('setState', data.status=="0" ? false : true);
             $('#hiddentxt<%=fnPrefix%>').val(args.id);
             return false        
            });
            
            promiseMasterUpdate.fail(function(){
            console.log("update master fail");
            });

      }
      function DeleteMasterData(args)
      {
           $('#confirm-dialog-<%=fnPrefix%>').modal('show');
            $("#btnConfirmOk").click(function (e) { <%=fnPrefix%>_PerformDelete(args); });
      }
      function <%=fnPrefix%>_PerformDelete(args)
      {
      var promiseMasterDelete = $.ajax({ url: location.origin + '<%=apidelete%>/' + args.id });
            promiseMasterDelete.done(function(data){
               setTimeout(function () {
                    $("#confirm-dialog-<%=fnPrefix%>").modal('hide');
                    noty({ "text": "Deleted Successfully", "layout": "top", "type": "success" });
                }, 0);
                 setTimeout(<%=fnPrefix%>ListMasterList, 0);
             return false;
     
            });
    
            promiseMasterDelete.fail(function(){
                console.log("master delete fail");
            });
        }
      
</script>